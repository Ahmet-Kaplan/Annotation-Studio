<%= render "/shared/document_titles" %>

<h1>Search Annotations</h1>



<p> Query: <%= params['search'] %></p>
<p> Search Mode: <%= @method %></p>



<div id="annotations-search-results" class="row">
	<p class="error"></p>
</div>





<%= javascript_include_tag "widget" %>
<script type="text/javascript" charset="utf-8">
jQuery(function ($) {
  var widget = new Widget.App();
  var endpoint = '<%= ENV["API_URL"] %>';
  var token = '<%= session["jwt"] %>';
  // Backbone.history.start({pushState: true, root: window.location})

var groups=[];

<% current_user.groups.each do |g| %>
  groups.push("<%=g.name %>");
<% end %>

var query;

<% if @method == 'user' %>

	<% if User.find_by(firstname: params['search']).nil? %>
		query = "nothing here";
	<% else %>
		query = "<%= User.find_by(firstname: params['search']).email %>"
	<% end %>

	 var searchLoadOptions = {
	    'limit': 100,
	    'groups': "<%= current_user.rep_group_list %>".split(/, /),
	    'subgroups': "<%= current_user.rep_subgroup_list %>".split(/, /),
	    'host': location.host,
	    'user': query,
	    'mode': 'userSearch',
	    'context': 'dashboard',
	  };

<% else %>
	query = ["<%= params['search'] %>"]
	var searchLoadOptions = {
	    'limit': 100,
	    'groups': query,
	    'subgroups': "<%= current_user.rep_subgroup_list %>".split(/, /),
	    'host': location.host,
	    'user': "<%= current_user.email%>",
	    'mode': 'class',
	    'context': 'dashboard',
	  };


<% end #end @method %>

	widget.listAnnotations('annotations-search-results', searchLoadOptions, endpoint, token);


  if (query == "nothing here"){
		$(".error").text("No Results Found");
	}
});

	

</script>
<script type="text/template" id="user-comment-template">


  <span class="user-highlight" id="{{uuid}}">
  <div class="ellipsis"><a href="{{uri}}#hl{{uuid}}">"{{{quote}}}"</a></div>
  <hr>
</span>

<span class="user-comment"><div class="ellipsis">{{{text}}}</div>
  <span class= "annotation-info">{{formattedDate}} <br>
    Document: {{title}} <br>
    Annotator: {{username}}
  </span> 
  </span>
  
</script>

<script type="text/template" id="user-highlight-template">
  <span class="user-highlight"><div class="ellipsis"><a href="{{uri}}#hl{{uuid}}">{{{quote}}}</a></div>
  <hr>
  </span>
  <span class="user-comment">
    <span class= "annotation-info">{{formattedDate}} <br>
    Document: {{title}} <br>
    Annotator: {{username}}
  </span> 
</span>
</script>


<style>
	
.row{
  display:flex;
  flex-wrap: wrap;
}

.column{
  background-color: white;
  float: left;
  width: 15%;
  height: 200px;
  padding:5px;
  margin:10px 2% 0;
}

</style>