<%= content_for :body_id, 'dashboard' %>
<%= content_for :body_class, 'index' %>
<%= content_for :page_title, 'Dashboard' %>
<%= stylesheet_link_tag "users" %>
<%= render "/shared/document_titles" %>

<center>
<div class="dropdown">
  <button class="dropbtn">Documents</button>
  <div class="dropdown-content">
    <a id="documents-mine">Mine</a>
    <a href="<%= documents_path %>">Shared</a>
    <a href="<%= new_document_path %>">New</a>
  </div>
</div>

<div class="dropdown">
  <button class="dropbtn">Annotations</button>
  <div class="dropdown-content">
    <a id= "annotations-mine"> Mine</a>
    <a href="#shared">Shared</a>
    <a href="#">Bookmarked</a>
  </div>
</div>


<div class="dropdown">
  <button class="dropbtn">Groups</button>
  <div class="dropdown-content">
    <a id="groups-mine">Mine</a>
    <a id="groups-joined">Joined</a>
    <a href="<%= new_group_path %>">New</a>
  </div>
</div>
</center>

<div class= "content" id="my-docs" style="display:none">
  <div class="row">
  <% current_user.documents.order("created_at DESC").each do |doc| %>

    <div class= "column"> 
       Title: <%= doc.title %> <br>
       Author: <%= doc.author %> <br>
       Created: <%= doc.created_at.strftime("%m/%d/%Y") %> 
       <span style="font-size: 12px">Groups: <%= doc.groups.pluck(:name) %> </span>
       <br>
       <br>
       <%= link_to "Edit", controller: "documents", action: "edit", id: doc.id %>
    </div>
  <% end %>
  </div>  
</div>

<div class = "content" id="my-annotations" style="display:none">
  <ul id="my-annotation-list" class="list-group"></ul>

</div>

<div class = "content" id="my-groups" style="display:none">
  <div class="row">

  <% @mygroups.each do |g| %>
    <div class= "column"> 
       <strong>Name:</strong> <%= Group.find(g.group_id).name %> <br>
       <br>
       <br>
       <%= link_to "Edit", edit_group_path(id: g.group_id) %>
    </div>
  <% end %>
  </div>
</div>

<div class = "content" id="joined-groups" style="display:none">
  <div class="row">
  <% current_user.groups.order("name ASC").each do |g| %>
    <div class= "column"> 
       <strong>Name:</strong> <%= g.name %> <br>
       <strong>Role:</strong> <%= Membership.find_by(group_id: g.id, user_id: current_user.id).role %>
    </div>
  <% end %>
  </div>
</div>




<script type="text/javascript">

  var myDocuments = document.getElementById("my-docs");
  $("#documents-mine").click(function(){
    $(".content").hide();
    myDocuments.style.display = "block";
  }); 

  $("#annotations-mine").click(function(){
    var myAnnotations = document.getElementById("my-annotations");
    $(".content").hide();
    myAnnotations.style.display = "block";
  });

  

  $("#groups-joined").click(function(){
    var joinedGroups = document.getElementById("joined-groups");
    $(".content").hide();
    joinedGroups.style.display = "block";
  });

  $("#groups-mine").click(function(){
    var mygroups = document.getElementById("my-groups");
    $(".content").hide();
    mygroups.style.display = "block";
  });

$("button").click(function(){
    $(".content").hide();
  });

</script>




<style>
.dropbtn {
  background-color: #4CAF50;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}

.dropdown {
  position: relative;
  display: inline-block;
  padding-right: 100px;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown-content a:hover {background-color: #ddd;}

.dropdown:hover .dropdown-content {display: block;}

.dropdown:hover .dropbtn {background-color: #3e8e41;}

.row{
  display:flex;
  flex-wrap: wrap;
}

.column{
  background-color: white;
  float: left;
  width: 14%;
  height: 150px;
  padding:5px;
  margin:20px 2% 0;
}
</style>


<%= javascript_include_tag "widget" %>
<script type="text/javascript" charset="utf-8">
jQuery(function ($) {
  var widget = new Widget.App();
  var endpoint = '<%= ENV["API_URL"] %>';
  var token = '<%= session["jwt"] %>';
  // Backbone.history.start({pushState: true, root: window.location})

var groups=[];

<% current_user.groups.each do |g| %>
  groups.push("<%=g.name %>");
<% end %>

  var myLoadOptions = {
    'limit': 20,
    'groups': "<%= current_user.rep_group_list %>".split(/, /),
    'subgroups': "<%= current_user.rep_subgroup_list %>".split(/, /),
    'host': location.host,
    'user': "<%= current_user.email %>",
    'mode': 'user',
    'context': 'dashboard',
  };
  var classLoadOptions = {
    'limit': 20,
    'groups': groups, //"<%= current_user.rep_group_list %>".split(/, /),
    'subgroups': "<%= current_user.rep_subgroup_list %>".split(/, /),
    'host': location.host,
    'user': "<%= current_user.email %>",
    'mode': 'class',
    'context': 'dashboard',
  };
  var groupLoadOptions = {
    'limit': 20,
    'groups': "<%= current_user.rep_group_list %>".split(/, /),
    'subgroups': "<%= current_user.rep_subgroup_list %>".split(/, /),
    'host': location.host,
    'user': "<%= current_user.email %>",
    'mode': 'group',
    'context': 'dashboard',
  };

  widget.listAnnotations('my-annotation-list', myLoadOptions, endpoint, token);
  widget.listAnnotations('class-annotation-list', classLoadOptions, endpoint, token);
  widget.listAnnotations('group-annotation-list', groupLoadOptions, endpoint, token);
});

</script>
<script type="text/template" id="user-comment-template">
  <span class="user-highlight" id="{{uuid}}"><span class="pull-right">{{formattedDate}}</span><div class="ellipsis"><a href="{{uri}}#hl{{uuid}}">{{{quote}}}</a></div>


</span>
  <span class="user-comment"><div class="ellipsis">{{{text}}}</div><div class="secondary-text">{{title}} ({{username}})</div>
  </span>
</script>
<script type="text/template" id="user-highlight-template">
  <span class="user-highlight"><div class="ellipsis"><a href="{{uri}}#hl{{uuid}}">{{{quote}}}</a></div></span>
  <span class="user-comment"><div class="secondary-text">{{title}} ({{username}})</div></span>
</script>
  